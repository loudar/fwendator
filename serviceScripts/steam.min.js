async function f(o){let n=await fetch(o,{credentials:"include"});if(n.status===429)console.log("Rate limit exceeded, waiting 60s..."),await new Promise((c)=>setTimeout(c,60000)),await f(o);return await n.text()}async function b(){let o=document.querySelectorAll(".friend_block_v2"),n=[],c=5*o.length;console.log(`Estimated time: ${c} seconds`);for(let e=0;e<o.length;e++){console.log(`Processing friend ${e+1} of ${o.length}`);let t=o[e],s=t.attributes["data-steamid"].nodeValue,i=t.attributes["data-miniprofile"].nodeValue,l=t.querySelector("img").src,y=t.querySelector("a").href,p=t.querySelector(".friend_block_content").textContent.split(`
`).at(0).replace(/\*$/g,""),u=document.createElement("div");u.innerHTML=await f(`https://steamcommunity.com/actions/PlayerList/?type=friendsincommon&target=${i}`);let d=u.querySelectorAll(".friendBlock"),m={id:s,name:p,profileUrl:y,avatarUrl:l,mutual:[],source:"steam"};if(d.length>0)for(let a of d){let h=a.querySelector("a").href;m.mutual.push(h)}n.push(m),console.log("Waiting 5s..."),await new Promise((a)=>setTimeout(a,5000))}console.log(n);let r={};for(let e of n){let t=[];for(let s of e.mutual){let i=n.find((l)=>l.profileUrl===s);if(i)t.push(i.id);else console.warn(`Could not find mutual ${s}`)}e.mutual=t,r[e.id]=e}return r}var g=await b();console.log(g);var w=URL.createObjectURL(new Blob([JSON.stringify(g)],{type:"application/json"}));Object.assign(document.createElement("a"),{href:w,download:"steam_friends.json"}).click();setTimeout(()=>{URL.revokeObjectURL(w)},2000);
